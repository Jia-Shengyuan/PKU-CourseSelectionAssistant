# PKU Course Selection Assistant

## 项目概述

这是一个可以根据你提供的个人介绍、选课计划等信息，去自动爬取树洞课程评测，并通过大模型汇总来辅助选课的项目，免去了选课时同学们手工搜索树洞大量评测的麻烦。

## 要运行本项目，你只需要做如下几件事：
1. 下载
2. 配置环境
3. 获取一个能够和大模型对话的 API Key
4. 启动项目，之后打开对应网页
5. 填写网页中需要的信息，设置好年级、学期、课程列表等
6. 点击开始搜索推荐按钮，之后等待即可

### 下载：

打开终端并进入你准备放置本项目的文件夹，然后运行
```bash
git clone https://github.com/Jia-Shengyuan/PKU-CourseSelectionAssistant.git
```
你也可以选择将项目下载到本地，然后解压到你喜欢的地方。

### 配置 Python 环境：

安装 Python (开发环境为 3.12.7 版本)
   - 访问 [Python官网](https://www.python.org/) 下载并安装
   - 确保安装时将 Python 添加到系统环境变量

安装依赖包：先在终端中进入本项目根目录，之后运行
```bash
pip install -r requirements.txt
```
### 配置浏览器环境：

确保你的电脑上安装了 Chorme 浏览器即可。

如果没有，可以访问 [Chrome 官网](https://www.google.com/chrome/) 下载并安装。

### 获取 API Key：

获取 API Key 的目的是调用大模型对话服务商提供的对话服务。目前市面上有很多大模型对话服务商，我们这里以硅基流动为例：

- 访问[硅基流动](https://account.siliconflow.cn/zh/login)网站并注册账号
- 点击左侧的“API 密钥”，之后点击“新建 API 密钥”
- 新用户通常自带一定使用额度。但若要大规模使用，你可能需要实名认证并充值（这样的服务当然是花钱的！）

### 项目运行

打开终端，进入项目所在根目录后运行
```bash
uvicorn api.main:app --reload
```
可以看到出现了一个网址，打开即可。通常为 [http://127.0.0.1:8000](http://127.0.0.1:8000)。

打开网页后，在其中填写配置与选课信息，即可开始自动爬取评价并选课。其中唯一不能在网页中完成的一步是配置你的培养方案，你需要将其命名为 `plan.pdf` 并放在项目根目录下的 `config` 文件夹中。

注意：在网页中填入年级与学期后，需要点击“设定学期”按钮，之后才能添加课程。如果你使用的是硅基流动平台，则无需改动网址，默认配置已经帮你填好了。

你在填写过程中，随时可以点击保存按钮并安全地退出。再次运行（或刷新网页）时，这些信息都会被重新加载进来。

填写完成后，点击“开始搜索推荐”，程序就会开始自动爬取树洞课程，以及大模型汇总选课等一系列过程。**如果你是第一次运行，或者与上一次运行之间间隔了很长的时间，你需要手动在弹出的树洞界面中登录。**

课表生成结束后将自动展示，同时程序会将其保存在 `output` 文件夹下。如果你之后还想查看大模型对课程的评价，可以在 `selevaluator/data` 下查看。如果你想查看树洞的原始评价，可以在 `crawler/data` 下查看。

---

## 如果你要修改本项目

***注意，这属于“进阶玩法”。如果你只是一个想运行项目的小白，你只需看上面的部分。***

### 前端环境配置
1. 安装 Node.js
   - 访问 [Node.js 官网](https://nodejs.org/) 下载并安装
   - 建议安装 LTS（长期支持）版本
   - 确保安装时将Node.js添加到系统环境变量

2. 安装 pnpm
   ```bash
   npm install -g pnpm
   ```

3. 安装前端依赖（同样是先在终端中进入本项目根目录，之后再输入下方指令）
   ```bash
   cd ui
   pnpm install
   ```

### 项目运行

项目的运行需要同时启用前后端。

启动后端：使用终端进入根目录后
```bash
uvicorn api.main:app --reload
```

启动前端（需要新开一个终端，后端的不关）：
```bash
cd ui
pnpm run dev
```

之后按照这个终端输出打开前端对应网页即可，默认情况下一般为 [http://localhost:5173/](http://localhost:5173/)。

### 前端打包

```bash
cd ui
pnpm run build
```

-------

## 树洞信息获取

**重要提醒**：树洞爬虫功能需要 Chrome 浏览器支持，请确保已按照上述"浏览器配置"部分安装 Chrome。

update 2025.5.9 by zcxxnqwq:

修了爬虫。实现了每门课的测评分别存储在一个 HTML 里，存储在 `crawler` 目录下。

只存登录 cookies 似乎因为反爬虫机制无法自动登录，以后的每次登录依然需要短信验证码。现采用从 Chrome 用户数据目录直接复用登录态的方法，`config.json` 新增 `chrome_user_data_dir` 用于让用户填写用户目录地址，目前我的电脑上不出错的方式是自己新建文件夹 `C:\Users\用户名\PKU-Chrome-Profile`，在 config 里填写这个路径，然后需要手动登录一次，使这个目录下存储登录状态，之后每次本设备访问树洞无需登录。

### 浏览器配置补充说明

1. **Chrome 用户数据目录设置**：
   - 在前端界面的"爬虫配置"部分，需要设置 Chrome 用户数据目录
   - 建议创建专用目录，如：`C:\Users\你的用户名\PKU-Chrome-Profile`
   - 首次使用时需要在弹出的浏览器窗口中手动登录树洞

2. **常见错误处理**：
   - 如果遇到 "cannot find Chrome binary" 错误，请确保已安装 Chrome 浏览器
   - 如果 ChromeDriver 下载失败，可能是网络问题，请检查网络连接或更换网络环境

# 课程评分器

## 使用方法:
`import course_evaluate.evaluator.evaluator as evaluator` 
`evaluator.evaluate_course(ls)`

输出的课程评价在`crawler\data`目录下, 每次调用函数会清除该目录下的全部`json`文件

评价逐个老师进行

其中`ls`为课程名称列表, 如 `ls = {"人工智能基础","微电子与电路基础"}`

需要依赖`crawler/data`中的html文件, 已经隐藏内部细节
## 样例:
运行根目录下的`test_evaluator.py`


# 前端（UI）

## 项目结构
```
选课辅助系统/
├── ui/                # 前端项目目录
│   └── README.md     # [前端项目说明](./ui/README.md)
├── ...               # 其他目录
└── README.md         # 项目说明
```

## 前端项目
前端项目使用 Vue 3 + Element Plus 构建，详细说明请参见 [前端项目文档](./ui/README.md)。

## 数据库2.0

update 民国114年5月14日19点19分 by devout

新版数据库接口功能基本实现